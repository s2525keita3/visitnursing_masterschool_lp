# お問い合わせフォーム（ContactForm）要件定義書

## 1. 概要

### 1.1 目的
訪問看護ステーション開業支援サービスの無料セミナー申込および個別相談申込を受け付けるためのフォームコンポーネント。

### 1.2 対象ユーザー
- 訪問看護ステーション開業を検討している看護師
- 訪問看護ステーション経営者
- 開業準備中の方

### 1.3 技術スタック
- React 19.2.0
- TypeScript
- Tailwind CSS v4
- カスタムフック（useForm）

---

## 2. 機能要件

### 2.1 フォーム入力項目

#### 2.1.1 お名前（name）
- **必須項目**: ✅ 必須
- **入力タイプ**: テキスト入力（`<input type="text">`）
- **プレースホルダー**: "山田 太郎"
- **バリデーション**:
  - 空欄不可
  - 2文字以上（前後の空白をトリム）
- **エラーメッセージ**: 
  - 空欄の場合: "お名前を入力してください"
  - 2文字未満の場合: "お名前は2文字以上で入力してください"
- **アクセシビリティ**: 
  - `aria-label="お名前"`
  - `aria-invalid={!!errors.name}`
  - `aria-describedby={errors.name ? "name-error" : undefined}`

#### 2.1.2 メールアドレス（email）
- **必須項目**: ✅ 必須
- **入力タイプ**: メール入力（`<input type="email">`）
- **プレースホルダー**: "example@email.com"
- **バリデーション**:
  - 空欄不可
  - メールアドレス形式チェック（正規表現: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`）
- **エラーメッセージ**:
  - 空欄の場合: "メールアドレスを入力してください"
  - 形式不正の場合: "正しいメールアドレスを入力してください"
- **アクセシビリティ**: 
  - `aria-label="メールアドレス"`
  - `aria-invalid={!!errors.email}`
  - `aria-describedby={errors.email ? "email-error" : undefined}`

#### 2.1.3 電話番号（phone）
- **必須項目**: ❌ 任意
- **入力タイプ**: 電話番号入力（`<input type="tel">`）
- **プレースホルダー**: "090-1234-5678"
- **バリデーション**:
  - 入力された場合のみ形式チェック
  - 数字とハイフンのみ許可（正規表現: `/^[\d-]+$/`、空白は除去してチェック）
- **エラーメッセージ**:
  - 形式不正の場合: "正しい電話番号を入力してください"
- **アクセシビリティ**: 
  - `aria-label="電話番号"`
  - `aria-invalid={!!errors.phone}`
  - `aria-describedby={errors.phone ? "phone-error" : undefined}`

#### 2.1.4 お申し込み種別（contactType）
- **必須項目**: ✅ 必須
- **入力タイプ**: ラジオボタン（`<input type="radio">`）
- **選択肢**:
  1. **セミナー申込** (`value="seminar"`)
     - 説明: "無料オンラインセミナーに参加"
     - デフォルト選択: ✅
  2. **個別相談** (`value="consultation"`)
     - 説明: "60分のZoom面談で個別相談"
- **レイアウト**: 
  - モバイル: 縦並び（1列）
  - デスクトップ: 横並び（2列、`sm:grid-cols-2`）
- **インタラクション**:
  - ホバー時: ボーダー色変更（`hover:border-brand-orange/30`）、背景色変更（`hover:bg-brand-orange/5`）
  - 個別相談選択時: セミナー日程フィールドをクリア
- **アクセシビリティ**: 
  - `aria-label="セミナー申込"` / `aria-label="個別相談"`

#### 2.1.5 希望セミナー日程（seminarDate）
- **必須項目**: ✅ 条件付き必須（セミナー申込を選択した場合のみ）
- **入力タイプ**: セレクトボックス（`<select>`）
- **表示条件**: `form.contactType === "seminar"` の場合のみ表示
- **初期値**: 空文字列（`""`）
- **選択肢**: `scheduleOptions`から動的生成
  - 現在の日程:
    - "12月7日（日） 11:00 - 12:00"
    - "12月14日（日） 11:00 - 12:00"
    - "12月16日（火） 20:30 - 21:30"
    - "12月21日（日） 11:00 - 12:00"
  - デフォルトオプション: "日程を選択してください"（`value=""`）
- **バリデーション**:
  - セミナー申込選択時は必須
- **エラーメッセージ**:
  - 未選択の場合: "希望セミナー日程を選択してください"
- **アクセシビリティ**: 
  - `aria-label="希望セミナー日程"`
  - `aria-invalid={!!errors.seminarDate}`
  - `aria-describedby={errors.seminarDate ? "seminarDate-error" : undefined}`

#### 2.1.6 ご相談内容（message）
- **必須項目**: ❌ 任意
- **入力タイプ**: テキストエリア（`<textarea>`）
- **行数**: 4行（`rows={4}`）
- **プレースホルダー**: お申し込み種別によって動的変更
  - セミナー申込: "開業予定時期、資金調達状況などをご記入ください。"
  - 個別相談: "開業予定時期、資金調達状況、ご相談内容などをご記入ください。"
- **バリデーション**: なし
- **アクセシビリティ**: 
  - `aria-label="ご相談内容"`

---

### 2.2 フォーム送信機能

#### 2.2.1 送信ボタン
- **ラベル**: お申し込み種別によって動的変更
  - セミナー申込: "セミナーに申し込む"
  - 個別相談: "個別相談を申し込む"
- **送信状態**:
  - 通常: ボタン表示
  - 送信中: "送信中..." 表示、ボタン無効化（`isLoading={true}`）
  - 成功: 成功メッセージ表示
  - エラー: エラーメッセージ表示

#### 2.2.2 送信処理フロー
1. **フォーム送信イベント** (`onSubmit`)
   - デフォルト動作をキャンセル（`e.preventDefault()`）
2. **バリデーション実行** (`status="validating"`)
   - `validateContactForm`関数を実行
   - エラーがある場合: `status="error"`、処理中断
3. **送信処理** (`status="submitting"`)
   - `onSubmit`コールバックを実行（非同期）
   - 現在はモック実装（1秒待機）
   - 開発環境のみ`console.log`で送信データを出力
4. **成功時** (`status="success"`)
   - フォーム値を初期値にリセット
   - エラーをクリア
   - 成功メッセージ表示: "送信が完了しました。24時間以内にご連絡いたします。"
5. **エラー時** (`status="error"`)
   - エラーメッセージ表示
   - フォーム全体エラー: "送信に失敗しました。もう一度お試しください。"

#### 2.2.3 送信状態管理
- **状態値**: `FormStatus`型
  - `"idle"`: 初期状態
  - `"validating"`: バリデーション中
  - `"submitting"`: 送信中
  - `"success"`: 送信成功
  - `"error"`: 送信エラー

---

### 2.3 バリデーション機能

#### 2.3.1 バリデーションタイミング
- **リアルタイム**: 入力フィールド変更時にエラーをクリア
- **送信時**: フォーム送信時に全項目をバリデーション

#### 2.3.2 バリデーションルール詳細

| 項目 | 必須 | 最小文字数 | 最大文字数 | 形式チェック | 条件付き必須 |
|------|------|-----------|-----------|-------------|------------|
| お名前 | ✅ | 2文字 | - | - | - |
| メールアドレス | ✅ | - | - | メール形式 | - |
| 電話番号 | ❌ | - | - | 数字・ハイフンのみ | - |
| お申し込み種別 | ✅ | - | - | - | - |
| 希望セミナー日程 | ✅ | - | - | - | セミナー申込時のみ |
| ご相談内容 | ❌ | - | - | - | - |

#### 2.3.3 エラー表示
- **個別フィールドエラー**: 
  - フィールド下に赤色テキストで表示
  - `role="alert"`属性付き
  - `id`属性で`aria-describedby`と連携
- **フォーム全体エラー**:
  - 赤色ボーダーと背景色のボックスで表示
  - `role="alert"`属性付き

---

### 2.4 UI/UX機能

#### 2.4.1 アニメーション
- **フォーム全体**: フェードインアニメーション（`animate-fade-up`）
- **アニメーション遅延**: `ANIMATION_DELAYS.BASE`（0.1秒）
- **成功メッセージ**: フェードインアニメーション（`animate-fade-in`）

#### 2.4.2 視覚的フィードバック
- **フォーカス時**: 
  - オレンジ色のリング表示（`focus:ring-2 focus:ring-brand-orange/30`）
  - アウトラインなし（`focus:outline-none`）
- **エラー時**:
  - ボーダー色: 赤色（`border-red-500`）
  - フォーカスリング: 赤色（`focus:ring-red-500/30`）
- **ホバー時**（ラジオボタン）:
  - ボーダー色変更: `hover:border-brand-orange/30`
  - 背景色変更: `hover:bg-brand-orange/5`

#### 2.4.3 レスポンシブデザイン
- **モバイル**（デフォルト）:
  - フォーム: 1列レイアウト
  - お申し込み種別: 縦並び
- **デスクトップ**（`sm:`以上）:
  - お申し込み種別: 2列レイアウト（`sm:grid-cols-2`）

---

## 3. 非機能要件

### 3.1 パフォーマンス
- **再レンダリング最適化**: 
  - `useCallback`でイベントハンドラーをメモ化
  - `useForm`フックで状態管理を最適化
- **バンドルサイズ**: 
  - コード分割（`lazy`ロード）は適用されていない（ContactFormは重要コンポーネントのため）

### 3.2 アクセシビリティ（WCAG 2.1準拠）
- **キーボードナビゲーション**: 全フィールドがキーボードで操作可能
- **スクリーンリーダー対応**:
  - すべての入力フィールドに`aria-label`を設定
  - エラーメッセージに`role="alert"`を設定
  - `aria-invalid`でエラー状態を通知
  - `aria-describedby`でエラーメッセージとフィールドを関連付け
- **フォーカス管理**: フォーカスリングを視覚的に明確に表示

### 3.3 セキュリティ
- **XSS対策**: Reactのデフォルトエスケープ機能を使用
- **CSRF対策**: 現在は未実装（API実装時に追加が必要）
- **入力サニタイゼーション**: バリデーションで不正入力を防止

### 3.4 ブラウザ互換性
- **対応ブラウザ**: 
  - Chrome（最新版）
  - Firefox（最新版）
  - Safari（最新版）
  - Edge（最新版）
- **モバイルブラウザ**: iOS Safari、Chrome Mobile

---

## 4. データ要件

### 4.1 フォームデータ構造

```typescript
type ContactFormData = {
  name: string;              // お名前（必須、2文字以上）
  email: string;             // メールアドレス（必須、メール形式）
  phone: string;             // 電話番号（任意、数字・ハイフンのみ）
  message: string;           // ご相談内容（任意）
  contactType: "seminar" | "consultation";  // お申し込み種別（必須）
  seminarDate: string;        // 希望セミナー日程（条件付き必須）
};
```

### 4.2 初期値

```typescript
const initialState: ContactFormData = {
  name: "",
  email: "",
  phone: "",
  message: "",
  contactType: "seminar",    // デフォルト: セミナー申込
  seminarDate: "",
};
```

### 4.3 送信データ形式
- **現在**: モック実装（`console.log`で出力）
- **将来**: APIエンドポイントにJSON形式で送信予定

---

## 5. UIデザイン要件

### 5.1 レイアウト
- **セクション**: `Section`コンポーネントを使用（`tone="surface"`）
- **フォームコンテナ**: 
  - 角丸: `rounded-3xl`
  - ボーダー: `border border-brand-dark/5`
  - 背景: 白色（`bg-white`）
  - パディング: `p-10`
  - シャドウ: `shadow-card`
  - ホバー効果: `hover-lift`

### 5.2 タイポグラフィ
- **セクションタイトル**: 
  - ラベル: "CONTACT"（小文字、トラッキング広め）
  - メインタイトル: "セミナー申込または個別相談"（4xl、太字）
  - サブタイトル: "まずは無料セミナーで「経営の正解」を体感。個別相談も承ります。"
- **フィールドラベル**: 
  - フォントサイズ: `text-sm`
  - フォントウェイト: `font-semibold`
  - 色: `text-brand-dark`
- **エラーメッセージ**: 
  - フォントサイズ: `text-sm`
  - フォントウェイト: `font-semibold`
  - 色: `text-red-600`

### 5.3 カラースキーム
- **プライマリカラー**: オレンジ（`brand-orange`）
- **テキストカラー**: ダーク（`brand-dark`）
- **ミュートカラー**: `brand-muted`
- **エラーカラー**: 赤（`red-500`, `red-600`）
- **成功カラー**: エメラルド（`emerald-600`）

### 5.4 スペーシング
- **フォーム内の要素間**: `gap-6`
- **フィールド内の要素間**: `space-y-2`
- **お申し込み種別の選択肢間**: `gap-3`

---

## 6. エラーハンドリング

### 6.1 バリデーションエラー
- **個別フィールドエラー**: フィールド下に表示
- **フォーム全体エラー**: フォーム下部に表示
- **エラー表示タイミング**: 
  - リアルタイム: 入力時にエラーをクリア
  - 送信時: 全項目をバリデーション

### 6.2 送信エラー
- **ネットワークエラー**: フォーム全体エラーメッセージで表示
- **サーバーエラー**: エラーメッセージを`errors._form`に設定して表示
- **エラーメッセージ**: "送信に失敗しました。もう一度お試しください。"

---

## 7. 将来の拡張要件

### 7.1 API連携
- **エンドポイント**: 未定（TODOコメントあり）
- **送信形式**: JSON
- **認証**: 未定（CSRFトークンなど）

### 7.2 機能拡張
- **ファイルアップロード**: 事業計画書などの添付
- **確認画面**: 送信前の確認ステップ
- **自動返信メール**: 送信完了時の自動返信
- **入力内容の保存**: ブラウザのローカルストレージに一時保存

### 7.3 分析・トラッキング
- **コンバージョン計測**: Google Analytics等へのイベント送信
- **エラー追跡**: エラーログの収集（Sentry等）

---

## 8. テスト要件

### 8.1 単体テスト（未実装）
- バリデーション関数のテスト
- フォーム送信処理のテスト
- エラーハンドリングのテスト

### 8.2 統合テスト（未実装）
- フォーム送信フローのテスト
- API連携のテスト

### 8.3 E2Eテスト（未実装）
- ユーザーシナリオのテスト
- ブラウザ互換性テスト

---

## 9. 依存関係

### 9.1 内部依存
- `useForm`フック: フォーム状態管理
- `validateContactForm`関数: バリデーションロジック
- `scheduleOptions`: セミナー日程データ
- `CTAButton`コンポーネント: 送信ボタン
- `Section`コンポーネント: セクションラッパー

### 9.2 外部依存
- React 19.2.0
- TypeScript
- Tailwind CSS v4
- lucide-react（アイコン）

---

## 10. 制約事項

### 10.1 現在の制約
- APIエンドポイントが未実装（モック実装）
- エラーログサービス未統合
- テストコード未実装

### 10.2 技術的制約
- クライアントサイドのみの実装（サーバーサイドバリデーションは未実装）
- ブラウザのネイティブバリデーション（`required`属性）とカスタムバリデーションの併用

---

## 11. 変更履歴

- 2024年: 初版作成
- リファクタリング: `useForm`フックによる状態管理の統合
- リファクタリング: スクロールイベントリスナーの統合
- リファクタリング: マジックナンバーの定数化

---

## 12. 参考資料

- React公式ドキュメント: https://react.dev/
- TypeScript公式ドキュメント: https://www.typescriptlang.org/
- Tailwind CSS公式ドキュメント: https://tailwindcss.com/
- WCAG 2.1ガイドライン: https://www.w3.org/WAI/WCAG21/quickref/




